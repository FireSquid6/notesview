// @ts-expect-error no types
import extendedLatex from "marked-extended-latex";
import { markedHighlight } from "marked-highlight";
import Katex from "katex";
import { marked } from "marked";
import hljs from "highlight.js";
import fm from "front-matter";


const options = {
  render: (formula: string, displayMode: boolean) => { 
    const output = Katex.renderToString(formula, { 
      displayMode: displayMode,
      throwOnError: false,
    });

    return output;
  }
}
marked.use(extendedLatex(options));
marked.use(markedHighlight({
  emptyLangClass: "hljs",
  langPrefix: "hljs language-",
  highlight(code, lang) {
    const language = hljs.getLanguage(lang) ? lang : "plaintext";
    return hljs.highlight(code, { language }).value;
  }
}));



export async function renderHtml(markdown: string): Promise<string> {
  const { body } = fm(markdown);
  const html = await marked(body);

  return html;
}
